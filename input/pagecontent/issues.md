### General  

#### EMA ISO IDMP Implementation Guide

This IG follows the EMA IG, which has been published as a set of text documents. Currently, we don't have profiles for EMA IG, but we have the information needed for the profiles in the textual IG. Based on that information, the UNICOM PPL FHIR IG aims to be compliant with the EMA IG, but the number of data elements has been significantly reduced. Also, the elements defined as mandatory may differ. 


#### FHIR versions

EMA IG is based on FHIR version 4.6, but UNICOM PPL FHIR IG is based on version 5.0.0). This introduces some changes, most significantly:  
* Direction of reference has been changed for Ingredient
* In MedicinalProductDefinition name.countryLanguage has been renamed to name.usage, and name.namePart to name.part
* In PackagedProductDefinition package has been renamed to packaging  
* Pack size as containedItemQuantity (described as extension in EMA IG)

UNICOM IG started with FHIR R4B, and this work is still available in a separate branch.  


#### SPOR RMS lists
There is no official source for EMA SPOR RMS lists in FHIR format. The lists used in this IG are derived from the versions published by EMA, but there is room for interpretation what exactly should be included in the final FHIR value set. These value sets are not automatically updated from EMA sources.

All EMA SPOR RMS lists are defined as different code systems by EMA IG. Most value sets include all codes from the relevant code system. Exceptions to this are Authorised Dose Form (combines four EMA lists) and All Units (combines units of presentation and measurement).

EMA SPOR provides their own codes for concepts from international code systems (EDQM, UCUM, WHO ATC, ISO country and IETF language codes). While we can argue if this is the best approach, this IG follows the EMA IG in that regard. For ATC classication separate slices are created to capture WHO ATC code as well as EMA SPOR RMS code. 

#### Dose form attributes
Pharmaceutical dose form attributes (state of matter, etc) are not included in the example data, because this information is related to the dose form as such, not product. Information about dose form attributes is included in the EMA SPOR list and EDQM value set.  


### Identifiers
Key product indentifiers (MPID, PCID, PhPID, EMA PMS Id) are not available. In some cases fake identifiers have been used in the example data (see below). While only key identifiers have been explicitly mentioned in the profiles, other (including national) identifiers can be also provided.


#### MPID - Medicinal product identifier
The MPID is defined by the following segments: 
* country code segment (ISO 3166-1 alpha-2 code elements);
* marketing authorisation holder (i.e. location ID) code segment;
* medicinal product code segment (i.e. unique medicinal product ID).

Any change of the values related to these three code segments (as described in the Introductory section) should result in the assignment of a new MPID.  
This attribute will be automatically generated and maintained by the PMS system. In PPL data the identifier has been left empty or substituted with a fake identifier that follows the rules of the MPID.

Current EMA IG states the LOC-id as the marketing authorisation holder segment in the MPID. There was an expectation for it to be changed into ORG-id in the next EMA IG. Therefore, some products (mostly Estonian) use LOC-id in the MPID, while other products use ORG-id.


#### EMA PMS Identifier
In PMS, each individual medicinal product entry is assigned a single and unique PMS identifier (PMS ID) that remains unchanged through the lifecycle of the medicinal product. The PMS ID is a supplementary stable ID to any existing authorisation number or equivalent identifier as assigned by an authorising body.
The PMS ID is automatically generated by the PMS system based on the first submission of the medicinal product data to PMS. In PPL data the identifier has been left empty or substituted with a fake identifier.


#### PCID - Packaged product identifier

There are two components of a PCID:
* MPID for the Medicinal Product;
* Package description code segment, which refers to a unique identifier for each package e.g. 0001, 0002 etc.  
 
Any change of the values related to these code segments shall result in the assignment of a new PCID.
A unique PCID is assigned according to the following defining attributes of the package code segment:
* package item (container)(s) — the type, quantity (items per package), material(s);
* package component(s) — type, material(s)
* manufactured item(s) — manufactured dose form, unit of presentation, quantity (items per package).  

When the above defining attributes sets differ in any way a new PCID will be assigned. Pay attention that PCID is dependant on package material. This is also the reason why package material has been included in the PCID data set.


#### GTIN - GS1 Global Trade Item Number

ISO IDMP and EMA IG place GTIN identifier under Packaged Product data set (EMA IG chapter 4.8.6 Data carrier identifier).  
GTIN and PCID do not always map 1:1. For example, in case of centralised procedure, PCID is assigned to a package regardless of the language used on the package. Therefore, one PCID can map to several GTINs, because packages are printed in different languages.  

Also, the same package can have different PCIDs in different countries. For example, the Baltic countries have a procedure where packages are printed with all three languages on it, but the same package is actually registered following the national procedures, and the marketing authorisation holders do not have to be the same. In this case, one GTIN can map to several PCIDs, and the actual package has information about all three marketing authorisations on/in it.  


#### PhPID - Pharmaceutical product identifier

Pharmaceutical product identifiers are mostly not present in the data.

### Medicinal Product & Marketing Authorisation  

#### Name and name parts  
In regulatory data all products have a full name. 
In EMA IG name parts are considered mandatory, but the rules for using name parts allow situations where name parts don't add up to full name or are not describable according to the requirements. 
The order of name parts is not defined in EMA IG. All name parts (except delimiter part) can occur only once. An example in this IG where full name cannot be composed of name parts and is not conformant with EMA IG is [Canesten Kombi from Finland](Bundle-014-CanestenKombi-FI-FullProduct.html).  
  
Full name: **Canesten® Kombi 500 mg emätinpuikko + 10 mg/g emulsiovoide**  
Name parts: 
* **Canesten** - invented name part; 
* **®** - trademark part; 
* **500 mg** - strength part; 
* **emätinpuikko** - dose form part; 
* **+** - delimiter part; 
* **10mg/g** - strength part 2 (only one strength part allowed in EMA IG); 
* **emulsiovoide** - dose form part 2 (only one dose form part allowed in EMA IG).

In this IG only three name parts are defined, but other name parts can be used in product data if needed. All name parts are textual and provided in the language of the marketing authorisation region.

#### Authorised dose form  
EMA IG specifies two different dose forms for MedicinalProductDefinition: Authorised Pharmaceutical Form and Combined Pharmaceutical Form. However, authorised pharmaceutical form is defined as an extension, while combined pharmaceutical dose form is usually left blank or it repeats authorised dose form. Therefore, this profile does not use extension for authorised dose form, but expresses authorised dose form in the combinedPharmaceuticalDoseForm attribute, which according to FHIR specification is "The dose form for a single part product, or combined form of a multiple part product". 

Authorised dose form uses a value set that combines four different EMA SPOR lists. Manufactured item dose form and pharmaceutical dose form only use EMA SPOR list "Pharmaceutical dose form". Value sets are provided in the implementation guide.   

#### Marketing Authorisation
Information about marketing authorisation is captured in the RegulatedAuthorization resource, using type 'marketing authorisation'.
Status of the marketing authorisation comes from EMA RMS value set. There are several different values for marking a valid marketing authorisation. The EMA IG allows using any of the values from the list, so different countries, products may have a different concept used (for example, 'valid' or 'valid/renewed' both indicate that the marketing authorisation is valid).  

### Pharmaceutical/Administrable Product

#### PhPID not unique
The system of PhPIDs is used for classification, not identification of pharmaceutical products. PhPIDs are calculated from active ingredients, Pharmaceutical/Administrable Product definition itself also includes information about all the excipients in the product. Therefore, L4 PhPID does not identify a pharmaceutical product, and it is wrong to assume that PhPIDs could be unique within a system.  

#### Shareability of administrable products
Pharmaceutical/administrable products are normally not shared between medicinal products, as the list of excipients would be different in the original source. PPL example only has data about active ingredients, which results in having multiple seemingly identical pharmaceutical/administrable products.  

#### producedFrom attribute
ProducedForm attribute references manufactured items that the administrable product contains. For example, a combination product of creme and tablets, would probably have two pharmaceutical products and either one would have producedFrom attribute to only one of these manufactured items. A combination product of powder and solvent for solution, would have the solution as the pharmaceutical product and it would reference both manufactured items. 
While this information is useful and easy to provide in FHIR, this link between pharmaceutical products and manufactured items is not present in ISO IDMP logical model or EMA IG.  

#### Unit of presentation
Unit of presentation is used as a product charecteristic in the pharmaceutical/administrable product. According to EMA, no unit of presentation is defined for continuous pharmaceutical products (creme tubes, bottles, etc). There is no clear line between continuous and non-continuous products, especially when simple administration devices are provided in the package. Different interpretations may exist.  

### Ingredient & Manufactured Item

#### Concentration and presentation strength

Presentation strength can be per mass/volume of the unit of presentation.
Example: for a 0.6ml vial, both 6mg/vial and 6mg/0.6ml are considered presentation strength, but 10mg/1ml is concentration strength.

Presentation strength is typically given per manufactured item, but it can also be given for the volume of simplistic administration device that comes within the package (measuring cup, spoon, etc).

Reference strength does not have a distinction between presentation or concentration strength. In ISO IDMP model, reference strength is a subelement of strength, and the type of strength would be clear from the context. In FHIR, reference strength is positioned on the same level with concentration and presentation strength, which means that it cannot be stated if the reference strength used is concentration or presentation strength (normally it does not cause problems, as it's implied by the units used).

#### Reference strength

The most fiery discussions during the creation of this IG were around reference strength. The final decision was to conform to EMA IG (Ch 2. p 176; Ch 8. p28) and specify reference strength for all the active ingredients, simply repeating the strength in cases where no reference substance exists (e.g. clotrimazole).

There is no reference strength type in the EMA IG or FHIR specification, therefore this data element is not used in the PPL examples either. Reference strength in CDA documents can only be used together with the type of the reference strength, so this minor discrepancy has strong implications in certain contexts.

#### Comparator

According to EMA IG, each strength needs a comparator and an extension is used for using a comparator concept from RMS list. However, FHIR does not allow using a comparator (not even as an extension) for 'eguals to', which is considered to be the default value.  

#### Shareability of ingredients & manufactured items

Ingredient resources are not shared between medicinal products. They can be shared between manufactured items within one medicinal product, but it cannot be guaranteed. 
Ingredient can be and usually is shared between manufactured item and administrable/pharmaceutical product within the same medicinal product. However, for products that go through transformation, it is possible that the manufactured item ingredient may differ from administrable product ingredient (e.g. products where solid dose form is transformed into a solution, strength may change).

Ingredients reference manufactured items, which they belong to. This also defines the shareability of manufactured items. For example, vial of 2ml and vial of 5ml would have identical-looking manufactured items, because the size of vial is not included in the manufactured item definition. However, they would still have to have different IDs, because the linked ingredient contains presentation strength per vial, which would differ for 2ml and 5ml vial. 

#### Order of ingredients  

Order of ingredients is not defined in ISO IDMP or EMA IG. This does not normally cause problems in data model or queries, but may result in inconsistency how data is displayed in the user interface. This IG does not provide a solution to this problem.  


### Packaged Product  

#### Number of packages  
Product data may not include all pack sizes available in the country. Typically, more common pack sizes are used.

Some packages differ only by package material - these examples are included to show the implication of the package material being used for calculating PCID (see more below).

#### Shelf life / Storage  
In EMA IG shelf life period is using EMA SPOR codes for units. In FHIR, UCUM is required. Shelf life periods have been omitted from the data for now, but IG itself allows creating data with UCUM units if needed for a specific use case.  

#### Outermost package
The outermost package type according to EMA IG is always 'Box', even if it doesn't exist in reality (for example, calendar blisters bundled together with a film, are still considered a box).

#### Package material

PCID is dependant on the package material, therefore it is included in the data.

If different layers (blister’s top/bottom layer) are made of the same material, the material is not repeated as there is no way to distinguish layers or parts of a package.

Package material list in SPOR may not be sufficient for all cases. There might be a layer of dessicant for which the exact material may even be unknown. The package with dessicant may have different storage conditions than an equal package without dessicant.  

#### Device 
Currently, providing information about simple administration devices, like applicators or spoons, is not covered in the IG, but this data can be included according to the general FHIR specification.  

#### Manufactured Item quantity 
Element containedItem.Quantity in FHIR represents the size of the manufactured item (3ml vial) as well as the number of the manufactured items (14 tablets). Despite semantically they refer to different type of information, it does not normally cause confusion understanding the data.
